
# This one lets us jump out if its already present
application segateway-otel-timestampobserved[segateway-otel-timestampobserved] {
    filter {
        "${.otel.log.ObservedTimestamp}" ne ""
    };
};

# Set from split field and remove non standard kvs
block parser segateway-otel-timestampobserved-TimeUnix() {
    channel {
        rewrite {
            set('${.otel.scopeLog.logRecord.observedTimeUnix.millis}.${.otel.scopeLog.logRecord.observedTimeUnix.nanos}', value('.otel.log.ObservedTimestamp'));
            unset(value('.otel.scopeLog.logRecord.observedTimeUnix.millis'));
            unset(value('.otel.scopeLog.logRecord.observedTimeUnix.nanos'));
        };       
    };
};
application segateway-otel-timestampobserved-TimeUnix[segateway-otel-timestampobserved] {
    filter {
        "${.otel.scopeLog.logRecord.observedTimeUnix.millis}" ne ""
        and "${.otel.scopeLog.logRecord.observedTimeUnix.millis}" ne "0"
    };
    parser { segateway-otel-timestampobserved-TimeUnix(); };
};